<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîí Secure Telegram Files</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .security-badge {
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .file-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .file-card:hover {
            border-color: var(--secondary);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.15);
        }
        
        .file-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .icon-document { background: #ffc10720; color: #ffc107; }
        .icon-image { background: #17a2b820; color: #17a2b8; }
        .icon-video { background: #dc354520; color: #dc3545; }
        .icon-audio { background: #28a74520; color: #28a745; }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .alert-custom {
            border-left: 5px solid;
            border-radius: 10px;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="display-5 fw-bold">
                <i class="fas fa-shield-alt text-success"></i> Secure Telegram Files
            </h1>
            <p class="lead text-muted">Token secured in backend | No exposure</p>
            <span class="security-badge">
                <i class="fas fa-lock"></i> 100% Secure
            </span>
        </div>
        
        <!-- Status -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h5><i class="fas fa-server"></i> Backend Status</h5>
                        <div id="apiStatus" class="mt-2">
                            <span class="badge bg-secondary">Checking...</span>
                        </div>
                        <small class="text-muted" id="apiUrl"></small>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h5><i class="fas fa-robot"></i> Bot Status</h5>
                        <div id="botStatus" class="mt-2">
                            <span class="badge bg-secondary">Checking...</span>
                        </div>
                        <small class="text-muted">@StorageAjit_bot</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Channel Input -->
        <div class="card mb-4">
            <div class="card-body">
                <h5><i class="fas fa-hashtag"></i> Fetch Files</h5>
                <div class="row g-3 align-items-end">
                    <div class="col-md-8">
                        <label class="form-label">Channel Username:</label>
                        <div class="input-group">
                            <span class="input-group-text">@</span>
                            <input type="text" 
                                   class="form-control" 
                                   id="channelInput"
                                   placeholder="Enter channel username"
                                   value="Anon27199">
                        </div>
                        <small class="text-muted">Bot must be admin in channel</small>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-success w-100 py-2" onclick="loadFiles()" id="loadBtn">
                            <i class="fas fa-search"></i> Load Files
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Security Info -->
        <div class="alert alert-info alert-custom mb-4">
            <h5><i class="fas fa-info-circle"></i> Security Features</h5>
            <ul class="mb-0">
                <li>‚úÖ Bot token stored in backend environment variables</li>
                <li>‚úÖ No sensitive data in frontend code</li>
                <li>‚úÖ CORS restricted to https://anonedu.github.io</li>
                <li>‚úÖ All API calls through secure backend</li>
            </ul>
        </div>
        
        <!-- Loading -->
        <div id="loadingSection" class="loading" style="display: none;">
            <div class="spinner"></div>
            <h4>Fetching files securely...</h4>
            <p class="text-muted">Communicating through secure backend</p>
        </div>
        
        <!-- Error -->
        <div id="errorAlert" class="alert alert-danger alert-custom" style="display: none;">
            <h5><i class="fas fa-exclamation-triangle"></i> Error</h5>
            <p id="errorText"></p>
            <small id="errorHint" class="text-muted"></small>
        </div>
        
        <!-- Files Container -->
        <div id="filesContainer">
            <div class="text-center text-muted py-5">
                <i class="fas fa-folder-open fa-4x mb-3"></i>
                <h4>No files loaded yet</h4>
                <p>Enter channel username and click "Load Files"</p>
            </div>
        </div>
        
        <!-- Stats -->
        <div id="statsSection" class="row mt-4" style="display: none;">
            <div class="col-md-3 col-6 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h2 class="text-primary" id="totalFiles">0</h2>
                        <small class="text-muted">Total Files</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h2 class="text-success" id="channelName">-</h2>
                        <small class="text-muted">Channel</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>
                <i class="fas fa-code"></i> Backend: <code id="backendUrl">https://anonedu-backend2.vercel.app</code> |
                <i class="fas fa-laptop-code"></i> Frontend: <code>https://anonedu.github.io/telegram-files-secure/</code>
            </p>
            <p>
                <small>
                    Made with ‚ù§Ô∏è | Bot: @StorageAjit_bot | 
                    <a href="javascript:void(0)" onclick="showApiInfo()" class="text-decoration-none">
                        <i class="fas fa-question-circle"></i> API Info
                    </a>
                </small>
            </p>
        </div>
    </div>
    
    <!-- API Info Modal -->
    <div class="modal fade" id="apiModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-code"></i> API Information</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6>Backend URL:</h6>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="apiEndpoint" value="https://anonedu-backend2.vercel.app" readonly>
                        <button class="btn btn-outline-secondary" onclick="copyApiUrl()">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    
                    <h6>Endpoints:</h6>
                    <pre class="bg-light p-3 rounded"><code>GET /api/test
GET /api/files?channel=@username</code></pre>
                    
                    <div class="alert alert-success">
                        <i class="fas fa-shield-alt"></i>
                        Token is stored in backend environment variables - 100% secure
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Main JavaScript -->
    <script>
        // ==================== CONFIGURATION ====================
        // ‚úÖ YOUR BACKEND URL
        const SECURE_API_URL = 'https://anonedu-backend2.vercel.app';
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Set backend URL
            document.getElementById('backendUrl').textContent = SECURE_API_URL;
            document.getElementById('apiEndpoint').value = SECURE_API_URL;
            
            // Check API status
            checkApiStatus();
            
            // Enter key support
            document.getElementById('channelInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') loadFiles();
            });
            
            // Auto-load after 2 seconds
            setTimeout(() => {
                const channel = document.getElementById('channelInput').value;
                if (channel) {
                    if (!channel.startsWith('@')) {
                        document.getElementById('channelInput').value = '@' + channel;
                    }
                    loadFiles();
                }
            }, 2000);
        });
        
        // ==================== API FUNCTIONS ====================
        
        async function checkApiStatus() {
            try {
                const response = await fetch(`${SECURE_API_URL}/api/test`);
                const data = await response.json();
                
                if (data.status === 'secure') {
                    document.getElementById('apiStatus').innerHTML = 
                        '<span class="badge bg-success">‚úÖ Secure</span>';
                    document.getElementById('apiUrl').textContent = SECURE_API_URL;
                    
                    // Check bot connectivity
                    checkBotConnectivity();
                }
            } catch (error) {
                document.getElementById('apiStatus').innerHTML = 
                    '<span class="badge bg-danger">‚ùå Offline</span>';
            }
        }
        
        async function checkBotConnectivity() {
            try {
                const response = await fetch(`${SECURE_API_URL}/api/files?channel=@Anon27199&limit=1`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('botStatus').innerHTML = 
                        '<span class="badge bg-success">‚úÖ Connected</span>';
                } else {
                    document.getElementById('botStatus').innerHTML = 
                        '<span class="badge bg-warning">‚ö†Ô∏è Check token</span>';
                }
            } catch (error) {
                document.getElementById('botStatus').innerHTML = 
                    '<span class="badge bg-secondary">üîå Checking...</span>';
            }
        }
        
        // ==================== MAIN FUNCTION ====================
        
        async function loadFiles() {
            let channel = document.getElementById('channelInput').value.trim();
            
            // Validate
            if (!channel) {
                showError('Please enter channel username', 'Example: @Anon27199');
                return;
            }
            
            if (!channel.startsWith('@')) {
                channel = '@' + channel;
                document.getElementById('channelInput').value = channel;
            }
            
            // Show loading
            showLoading();
            
            try {
                const response = await fetch(`${SECURE_API_URL}/api/files?channel=${encodeURIComponent(channel)}`);
                const data = await response.json();
                
                if (data.success) {
                    // Update stats
                    document.getElementById('totalFiles').textContent = data.files.length;
                    document.getElementById('channelName').textContent = data.channel;
                    document.getElementById('statsSection').style.display = 'flex';
                    
                    // Display files
                    displayFiles(data.files);
                    hideError();
                } else {
                    showError(data.error || 'Failed to load files', 'Check channel permissions');
                }
            } catch (error) {
                showError('Network error: ' + error.message, 'Check backend URL');
            } finally {
                hideLoading();
            }
        }
        
        // ==================== DISPLAY FUNCTIONS ====================
        
        function displayFiles(files) {
            const container = document.getElementById('filesContainer');
            
            if (!files || files.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-folder-open fa-4x text-muted mb-3"></i>
                        <h4>No Files Found</h4>
                        <p>Channel might be empty or bot doesn't have access.</p>
                        <button class="btn btn-primary mt-2" onclick="loadFiles()">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4><i class="fas fa-list"></i> Files (${files.length})</h4>
                    <span class="badge bg-primary">Secure Connection</span>
                </div>
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            `;
            
            files.forEach((file, index) => {
                const iconClass = getIconClass(file.type);
                const fileSize = formatFileSize(file.size);
                
                html += `
                    <div class="col">
                        <div class="file-card h-100">
                            <div class="file-icon ${iconClass}">
                                <i class="fas ${getFileIcon(file.type)}"></i>
                            </div>
                            
                            <h6 class="fw-bold mb-2">
                                ${file.name || `File ${index + 1}`}
                            </h6>
                            
                            <div class="small text-muted mb-3">
                                <div class="mb-1">
                                    <i class="fas fa-tag"></i> 
                                    <span class="badge bg-secondary">${file.type}</span>
                                </div>
                                <div class="mb-1">
                                    <i class="fas fa-hdd"></i> ${fileSize}
                                </div>
                                <div class="mb-1">
                                    <i class="far fa-calendar"></i> ${file.date}
                                </div>
                                ${file.caption ? `
                                    <div class="mt-2">
                                        <i class="far fa-comment"></i> 
                                        ${file.caption.substring(0, 60)}${file.caption.length > 60 ? '...' : ''}
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="mt-auto">
                                <a href="${file.download_url}" 
                                   class="btn btn-success btn-sm w-100"
                                   target="_blank"
                                   download>
                                    <i class="fas fa-download"></i> Download
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ==================== HELPER FUNCTIONS ====================
        
        function getIconClass(fileType) {
            switch(fileType) {
                case 'image': return 'icon-image';
                case 'video': return 'icon-video';
                case 'audio': return 'icon-audio';
                default: return 'icon-document';
            }
        }
        
        function getFileIcon(fileType) {
            switch(fileType) {
                case 'image': return 'fa-image';
                case 'video': return 'fa-video';
                case 'audio': return 'fa-music';
                default: return 'fa-file-pdf';
            }
        }
        
        function formatFileSize(bytes) {
            if (!bytes) return 'Unknown';
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }
        
        function showLoading() {
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('filesContainer').innerHTML = '';
            document.getElementById('statsSection').style.display = 'none';
            document.getElementById('loadBtn').disabled = true;
            hideError();
        }
        
        function hideLoading() {
            document.getElementById('loadingSection').style.display = 'none';
            document.getElementById('loadBtn').disabled = false;
        }
        
        function showError(message, hint = '') {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorHint').textContent = hint;
            document.getElementById('errorAlert').style.display = 'block';
        }
        
        function hideError() {
            document.getElementById('errorAlert').style.display = 'none';
        }
        
        function showApiInfo() {
            new bootstrap.Modal(document.getElementById('apiModal')).show();
        }
        
        function copyApiUrl() {
            navigator.clipboard.writeText(SECURE_API_URL);
            alert('URL copied!');
        }
    </script>
</body>
</html>
